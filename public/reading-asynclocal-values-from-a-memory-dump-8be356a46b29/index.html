<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <script type="application/ld+json">

{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Reading AsyncLocal values from a memory dump",
  
  "image": "https://minidump.net/images/reading-asynclocal-values-from-a-memory-dump-8be356a46b29-1.webp",
  
  "datePublished": "2021-09-16T00:00:00Z",
  "dateModified": "2021-09-16T00:00:00Z",
  "author": {
    "@type": "Person",
    "name": "Kevin Gosse",
    
    "image": "https://minidump.net/images/profile.png"
    
  },
  "mainEntityOfPage": { 
    "@type": "WebPage",
    "@id": "https:\/\/minidump.net\/reading-asynclocal-values-from-a-memory-dump-8be356a46b29\/" 
  },
  "publisher": {
    "@type": "Organization",
    "name": "minidump.net",
    
    "logo": {
      "@type": "ImageObject",
      "url": "https://minidump.net/images/profile.png"
    }
    
  },
  "description": "This article explains how AsyncLocal values are stored in .NET and how to retrieve them from a memory dump.",
  "keywords": []
}

</script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.121.1 with theme Tranquilpeak 0.5.3-BETA">
<meta name="author" content="Kevin Gosse">
<meta name="keywords" content="">
<meta name="description" content="This article explains how AsyncLocal values are stored in .NET and how to retrieve them from a memory dump.">


<meta property="og:description" content="This article explains how AsyncLocal values are stored in .NET and how to retrieve them from a memory dump.">
<meta property="og:type" content="article">
<meta property="og:title" content="Reading AsyncLocal values from a memory dump">
<meta name="twitter:title" content="Reading AsyncLocal values from a memory dump">
<meta property="og:url" content="https://minidump.net/reading-asynclocal-values-from-a-memory-dump-8be356a46b29/">
<meta property="twitter:url" content="https://minidump.net/reading-asynclocal-values-from-a-memory-dump-8be356a46b29/">
<meta property="og:site_name" content="minidump.net">
<meta property="og:description" content="This article explains how AsyncLocal values are stored in .NET and how to retrieve them from a memory dump.">
<meta name="twitter:description" content="This article explains how AsyncLocal values are stored in .NET and how to retrieve them from a memory dump.">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2021-09-16T00:00:00">
  
  
    <meta property="article:modified_time" content="2021-09-16T00:00:00">
  
  
  
  
    
      <meta property="article:tag" content="dotnet">
    
      <meta property="article:tag" content="debugging">
    
      <meta property="article:tag" content="windbg">
    
      <meta property="article:tag" content="clrmd">
    
      <meta property="article:tag" content="async">
    
  


<meta name="twitter:card" content="summary">

  <meta name="twitter:site" content="@kookiz">


  <meta name="twitter:creator" content="@kookiz">






  <meta property="og:image" content="https://minidump.net/images/profile.png">
  <meta property="twitter:image" content="https://minidump.net/images/profile.png">





  <meta property="og:image" content="https://minidump.net/images/reading-asynclocal-values-from-a-memory-dump-8be356a46b29-1.webp">
  <meta property="twitter:image" content="https://minidump.net/images/reading-asynclocal-values-from-a-memory-dump-8be356a46b29-1.webp">


    <title>Reading AsyncLocal values from a memory dump</title>

    <link rel="icon" href="/favicon.png">
    

    

    <link rel="canonical" href="https://minidump.net/reading-asynclocal-values-from-a-memory-dump-8be356a46b29/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    
    
    <link rel="stylesheet" href="https://minidump.net/css/style-h6ccsoet3mzkbb0wngshlfbaweimexgqcxj0h5hu4h82olsdzz6wmqdkajm.min.css" />
    
    

    
      
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MQCXFBVCCM"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-MQCXFBVCCM', { 'anonymize_ip': false });
}
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="2">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="/" aria-label="Go to homepage">minidump.net</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="2">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="/#about" aria-label="Read more about the author">
          <img class="sidebar-profile-picture" src="https://minidump.net/images/profile.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Kevin Gosse</h4>
        
          <h5 class="sidebar-profile-bio">Kevin Gosse has been using Microsoft .NET technologies for more than 15 years, across client, server, and mobile applications. Passionate about debugging. He is Microsoft MVP and is currently employed at Datadog, where he works on the performance of the .NET APM.</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/" title="Home">
    
      <i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/tags" title="Tags">
    
      <i class="sidebar-button-icon fas fa-lg fa-tags" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/archives" title="Archives">
    
      <i class="sidebar-button-icon fas fa-lg fa-archive" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/#about" title="About">
    
      <i class="sidebar-button-icon fas fa-lg fa-question" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/kookiz" target="_blank" rel="noopener" title="Twitter">
    
      <i class="sidebar-button-icon fab fa-lg fa-twitter" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/kevingosse" target="_blank" rel="noopener" title="GitHub">
    
      <i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/index.xml" title="RSS">
    
      <i class="sidebar-button-icon fas fa-lg fa-rss" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.buymeacoffee.com/kevingosse" target="_blank" rel="noopener" title="Buy me a coffee">
    
      <i class="sidebar-button-icon fas fa-lg fa-coffee" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Buy me a coffee</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="2"
        class="
               hasCoverMetaIn
               ">
        <article class="post" id="top">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title">
      Reading AsyncLocal values from a memory dump
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2021-09-16T00:00:00Z">
        
  
  
  
  
    September 16 2021
  

      </time>
    
    
  </div>

</div>
          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              <p>This article explains how <a href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.asynclocal-1?view=net-5.0&amp;WT.mc_id=DT-MVP-5003493"><code>AsyncLocal</code></a> values are stored in .NET and how to retrieve them from a memory dump. Note that the code provided is written for .NET 5, but should be able to work for .NET Framework with minor modifications (the name of some internal fields have changed across versions).</p>
<h1 id="preparing-the-memory-dump">Preparing the memory dump</h1>
<p>First thing first, we need to prepare the memory dump that will serve as example for the whole article. For that, I used the following code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Diagnostics;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Threading;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> ClientApp
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Program</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> Total = <span style="color:#ae81ff">17</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> AsyncLocal&lt;<span style="color:#66d9ef">int</span>&gt;[] _asyncLocals;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> Program()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            _asyncLocals = <span style="color:#66d9ef">new</span> AsyncLocal&lt;<span style="color:#66d9ef">int</span>&gt;[Total];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i = <span style="color:#ae81ff">0</span>; i &lt; _asyncLocals.Length; i++)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                _asyncLocals[i] = <span style="color:#66d9ef">new</span> AsyncLocal&lt;<span style="color:#66d9ef">int</span>&gt;();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> Main(<span style="color:#66d9ef">string</span>[] args)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> program = <span style="color:#66d9ef">new</span> Program();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> countdown = <span style="color:#66d9ef">new</span> CountdownEvent(Total);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i = <span style="color:#ae81ff">0</span>; i &lt; Total; i++)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">var</span> thread = <span style="color:#66d9ef">new</span> Thread(state =&gt;
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">var</span> index = (<span style="color:#66d9ef">int</span>)state;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    Thread.CurrentThread.Name = index.ToString();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j = <span style="color:#ae81ff">0</span>; j &lt;= index; j++)
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        program._asyncLocals[j].Value = j;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    countdown.Signal();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    Thread.Sleep(Timeout.Infinite);
</span></span><span style="display:flex;"><span>                });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                thread.Start(i);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            countdown.Wait();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Console.WriteLine(<span style="color:#e6db74">&#34;Ready to capture dump. Process id {0}&#34;</span>, Process.GetCurrentProcess().Id);
</span></span><span style="display:flex;"><span>            Console.ReadLine();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The program creates an array of <code>AsyncLocal&lt;int&gt;</code> of 17 elements. 17 is not a random number, its significance will become clear in a moment. Then the program creates a few threads, and have them store a different number of asynclocal values, such as thread 1 will store 1 asynclocal value, thread 2 will store 2, and so on until thread 17. When all the values are initialized, the program displays a prompt and pauses to give time to capture a memory dump. This can be done using <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/procdump?WT.mc_id=DT-MVP-5003493">the procdump tool</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ procdump -ma &lt;pid&gt;
</span></span></code></pre></div><h1 id="inspecting-the-memory-dump-with-windbg">Inspecting the memory dump with WinDbg</h1>
<p>Now that we have our memory dump, let&rsquo;s start by inspecting it with WinDbg. We&rsquo;ll start by retrieving the array of <code>AsyncLocal&lt;int&gt;</code>. Recent versions of WinDbg automatically load the SOS extension when dealing with .NET Core memory dumps, so that&rsquo;s one less thing to do. We can use the <code>dumpheap</code> command to locate our instance of <code>Program</code>, and from there access the array.</p>
<p>For that, we first use <code>dumpheap -stat -type ClientApp.Program</code>to get the address of the MT, and then we feed it to <code>dumpheap -mt</code> to get the address of the instance:</p>
<pre tabindex="0"><code>0:000&gt; !dumpheap -stat -type ClientApp.Program
Statistics:
              MT    Count    TotalSize Class Name
00007ffb8e8e4968        1           24 ClientApp.Program
00007ffb8e9141d0        1           40 ClientApp.Program+&lt;&gt;c__DisplayClass3_0
Total 2 objects

0:000&gt; !dumpheap -mt 00007ffb8e8e4968 
         Address               MT     Size
000001c53436bb08 00007ffb8e8e4968       24     

Statistics:
              MT    Count    TotalSize Class Name
00007ffb8e8e4968        1           24 ClientApp.Program
Total 1 objects
</code></pre><p>Then we use <code>dumpobj</code> to dump the instance and from there we get the address of the value stored in the <code>_asyncLocals</code> field:</p>
<pre tabindex="0"><code>0:000&gt; !dumpobj 000001c53436bb08
Name:        ClientApp.Program
MethodTable: 00007ffb8e8e4968
EEClass:     00007ffb8e8fa988
Size:        24(0x18) bytes
File:        C:\Users\kevin.gosse\source\repos\ClrmdAsyncLocal\ClientApp\bin\Release\net5.0\ClientApp.dll
Fields:
              MT    Field   Offset                 Type VT     Attr            Value Name
00007ffb8e91b5c0  4000004        8 ...ivate.CoreLib]][]  0 instance 000001c53436bb78 _asyncLocals

0:000&gt; !dumpobj 000001c53436bb78
Name:        System.Threading.AsyncLocal`1[[System.Int32, System.Private.CoreLib]][]
MethodTable: 00007ffb8e91b5c0
EEClass:     00007ffb8e8067c8
Size:        160(0xa0) bytes
Array:       Rank 1, Number of elements 17, Type CLASS (Print Array)
Fields:
None
</code></pre><p>Now we can dump the contents of the array using <code>dumparray</code> and inspect the individual items:</p>
<pre tabindex="0"><code>0:000&gt; !dumparray 000001c53436bb78
Name:        System.Threading.AsyncLocal`1[[System.Int32, System.Private.CoreLib]][]
MethodTable: 00007ffb8e91b5c0
EEClass:     00007ffb8e8067c8
Size:        160(0xa0) bytes
Array:       Rank 1, Number of elements 17, Type CLASS
Element Methodtable: 00007ffb8e91b4d0
[0] 000001c53436bc18
[1] 000001c53436bc30
[2] 000001c53436bc48
[3] 000001c53436bc60
[4] 000001c53436bc78
[5] 000001c53436bc90
[6] 000001c53436bca8
[7] 000001c53436bcc0
[8] 000001c53436bcd8
[9] 000001c53436bcf0
[10] 000001c53436bd08
[11] 000001c53436bd20
[12] 000001c53436bd38
[13] 000001c53436bd50
[14] 000001c53436bd68
[15] 000001c53436bd80
[16] 000001c53436bd98

0:000&gt; !dumpobj 000001c53436bc18
Name:        System.Threading.AsyncLocal`1[[System.Int32, System.Private.CoreLib]]
MethodTable: 00007ffb8e91b4d0
EEClass:     00007ffb8e934ce8
Size:        24(0x18) bytes
File:        C:\Program Files\dotnet\shared\Microsoft.NETCore.App\5.0.10\System.Private.CoreLib.dll
Fields:
              MT    Field   Offset                 Type VT     Attr            Value Name
00007ffb8e940048  4000a28        8 ...Private.CoreLib]]  0 instance 0000000000000000 m_valueChangedHandler
</code></pre><p>Immediately we can see what the issue is going to be: in our instance of <code>AsyncLocal</code> there is… nothing. Literally nothing at all is stored inside, unless you provided a <code>valueChanged</code> handler (in which case, you will only find the address of your handler).</p>
<p>So where are those values stored? On the <code>Thread</code> object itself. The instance of <code>AsyncLocal</code> is just used as a key to retrieve the value from the execution context. If we take one thread at random, we can find all the asynclocal values from that thread stored in the <code>m_LocalValues</code> field of the execution context:</p>
<pre tabindex="0"><code>0:000&gt; !DumpObj /d 000001c53436be40
Name:        System.Threading.Thread
MethodTable: 00007ffb8e8ca8c0
EEClass:     00007ffb8e8b67d0
Size:        72(0x48) bytes
File:        C:\Program Files\dotnet\shared\Microsoft.NETCore.App\5.0.10\System.Private.CoreLib.dll
Fields:
              MT    Field   Offset                 Type VT     Attr            Value Name
00007ffb8e91c1e8  40009e6        8 ....ExecutionContext  0 instance 000001c53436dea0 _executionContext
0000000000000000  40009e7       10 ...ronizationContext  0 instance 0000000000000000 _synchronizationContext
00007ffb8e8c7a90  40009e8       18        System.String  0 instance 000001c53436d4f0 _name
00007ffb8e8c1a30  40009e9       20      System.Delegate  0 instance 0000000000000000 _delegate
00007ffb8e800c68  40009ea       28        System.Object  0 instance 0000000000000000 _threadStartArg
00007ffb8e80ee60  40009eb       30        System.IntPtr  1 instance 000001C534165830 _DONT_USE_InternalThread
00007ffb8e80b258  40009ec       38         System.Int32  1 instance                2 _priority
00007ffb8e80b258  40009ed       3c         System.Int32  1 instance                4 _managedThreadId
00007ffb8e80b258  40009ef      914         System.Int32  1   static                7 s_optimalMaxSpinWaitsPerSpinIteration
00007ffb8e807238  40009f0      918       System.Boolean  1   static                0 s_isProcessorNumberReallyFast
0000000000000000  40009f1      760                       0   static 0000000000000000 s_asyncLocalPrincipal
00007ffb8e8ca8c0  40009f2       18 ....Threading.Thread  0 TLstatic  t_currentThread
    &gt;&gt; Thread:Value 359c:000001c53436bf88 1940:000001c53436be40 7214:000001c53436c050 7034:000001c53436c128 6e38:000001c53436c200 7220:000001c53436c2d8 5684:000001c53436c3b0 4364:000001c53436c488 63ec:000001c53436c560 1970:000001c53436c638 6bcc:000001c53436c710 6890:000001c53436c7e8 69d0:000001c53436c8c0 1dc8:000001c53436c998 1db4:000001c53436ca70 6aa8:000001c53436cb48 6b94:000001c53436cc20 628:000001c53436ccf8 &lt;&lt;

0:000&gt; !DumpObj /d 000001c53436dea0
Name:        System.Threading.ExecutionContext
MethodTable: 00007ffb8e91c1e8
EEClass:     00007ffb8e935090
Size:        40(0x28) bytes
File:        C:\Program Files\dotnet\shared\Microsoft.NETCore.App\5.0.10\System.Private.CoreLib.dll
Fields:
              MT    Field   Offset                 Type VT     Attr            Value Name
00007ffb8e91e7c8  4000a69        8 ...syncLocalValueMap  0 instance 000001c53436de80 m_localValues
00007ffb8e91eb78  4000a6a       10 ...ing.IAsyncLocal[]  0 instance 0000000000000000 m_localChangeNotifications
00007ffb8e807238  4000a6b       18       System.Boolean  1 instance                0 m_isFlowSuppressed
00007ffb8e807238  4000a6c       19       System.Boolean  1 instance                0 m_isDefault
00007ffb8e91c1e8  4000a67      7f8 ....ExecutionContext  0   static 000001c53436bfd0 Default
00007ffb8e91c1e8  4000a68      800 ....ExecutionContext  0   static 000001c53436c010 DefaultFlowSuppressed

0:000&gt; !DumpObj /d 000001c53436de80
Name:        System.Threading.AsyncLocalValueMap+OneElementAsyncLocalValueMap
MethodTable: 00007ffb8e9408b8
EEClass:     00007ffb8e935de8
Size:        32(0x20) bytes
File:        C:\Program Files\dotnet\shared\Microsoft.NETCore.App\5.0.10\System.Private.CoreLib.dll
Fields:
              MT    Field   Offset                 Type VT     Attr            Value Name
00007ffb8e91b248  4000a2d        8 ...ading.IAsyncLocal  0 instance 000001c53436bc18 _key1
00007ffb8e800c68  4000a2e       10        System.Object  0 instance 000001c53436de68 _value1
</code></pre><p>The <code>_key1</code> field contains the address of the <code>AsyncLocal</code> instance, and the <code>_value1</code> field contains the value. So to check all the values stores in an <code>AsyncLocal</code> instance, we need to inspect every single thread. Not only that, but the way the values are stored is going to change depending on how many different <code>AsyncLocal</code> values are associated to a given thread. Managing that in WinDbg is going to be very tricky, so it&rsquo;s time to switch to ClrMD.</p>
<h1 id="inspecting-the-memory-dump-with-clrmd">Inspecting the memory dump with ClrMD</h1>
<p>Our ClrMD program will open the memory dump, find the <code>AsyncLocal</code> array, and extract all the values for every thread. To make things easier, we&rsquo;re going to use <a href="/analyze-your-memory-dumps-in-c-with-dynamd-8e4b110b9d3a">the DynaMD library</a>.</p>
<p>First thing first, we open the memory dump, and we locate the first (and only) instance of <code>AsyncLocal&lt;int&gt;[]</code> thanks to the <code>GetProxies</code> extension method. Then we iterate on every instance and give them to a helper method that will extract a list of thread ids and their associated values:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Collections.Generic;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Linq;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Threading;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Microsoft.Diagnostics.Runtime;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> ClrmdAsyncLocal
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Program</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> Main(<span style="color:#66d9ef">string</span>[] args)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">string</span> path = <span style="color:#e6db74">@&#34;C:\Users\kevin.gosse\Desktop\blog\asynclocal\ClientApp.exe_210916_114422.dmp&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> target = DataTarget.LoadDump(path);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> runtime = target.ClrVersions.First().CreateRuntime();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> heap = runtime.Heap;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> array = heap.GetProxies&lt;AsyncLocal&lt;<span style="color:#66d9ef">int</span>&gt;[]&gt;().First();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> item <span style="color:#66d9ef">in</span> array)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                Console.WriteLine(<span style="color:#e6db74">$&#34;Values stored in AsyncLocal {item}:&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> (threadId, <span style="color:#66d9ef">value</span>) <span style="color:#66d9ef">in</span> ExtractAsyncLocalValues(heap, (<span style="color:#66d9ef">ulong</span>)item))
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    Console.WriteLine(<span style="color:#e6db74">$&#34; - {threadId}: {(int)value}&#34;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Console.ReadLine();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;(<span style="color:#66d9ef">int</span> threadId, <span style="color:#66d9ef">dynamic</span> <span style="color:#66d9ef">value</span>)&gt; ExtractAsyncLocalValues(ClrHeap heap, <span style="color:#66d9ef">ulong</span> address)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// TODO</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The helper method will iterate on every thread, inspect the <code>AsyncLocal</code> values stored in the execution context, and filter them to only return the one associated to the given instance:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;(<span style="color:#66d9ef">int</span> threadId, <span style="color:#66d9ef">dynamic</span> <span style="color:#66d9ef">value</span>)&gt; ExtractAsyncLocalValues(ClrHeap heap, <span style="color:#66d9ef">ulong</span> address)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> thread <span style="color:#66d9ef">in</span> heap.GetProxies&lt;Thread&gt;())
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> threadId = thread._managedThreadId;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> localValues = thread._executionContext?.m_localValues;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">foreach</span> ((<span style="color:#66d9ef">dynamic</span> key, <span style="color:#66d9ef">dynamic</span> <span style="color:#66d9ef">value</span>) pair <span style="color:#66d9ef">in</span> ReadAsyncLocalStorage(localValues))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> ((<span style="color:#66d9ef">ulong</span>)pair.key == address)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">yield</span> <span style="color:#66d9ef">return</span> (threadId, pair.<span style="color:#66d9ef">value</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;(<span style="color:#66d9ef">dynamic</span> key, <span style="color:#66d9ef">dynamic</span> <span style="color:#66d9ef">value</span>)&gt; ReadAsyncLocalStorage(<span style="color:#66d9ef">dynamic</span> storage)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// TODO        </span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Now we just need to extract the values from the <code>AsyncLocal</code> storage… Which is where things get fancy. It turns out there&rsquo;s not one but many different storage implementations, depending on how many values the current thread is storing.</p>
<h3 id="from-1-to-3-values">From 1 to 3 values</h3>
<p>If a given thread stores one to three different <code>AsyncLocal</code> values, it will use an instance of <code>OneElementAsyncLocalValueMap</code>, <code>TwoElementAsyncLocalValueMap</code>, or… <code>ThreeElementAsyncLocalValueMap</code>. Those types just have a list of fields to store the keys and the values, <code>_key1</code> / <code>_key2</code> / <code>_key3</code> and <code>_value1</code> / <code>_value2</code> / <code>_value3</code> respectively. Extracting the values is just a matter of reading those fields:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;(<span style="color:#66d9ef">dynamic</span> key, <span style="color:#66d9ef">dynamic</span> <span style="color:#66d9ef">value</span>)&gt; ReadOneElementAsyncLocalValueMap(<span style="color:#66d9ef">dynamic</span> storage)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">yield</span> <span style="color:#66d9ef">return</span> (storage._key1, storage._value1);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;(<span style="color:#66d9ef">dynamic</span> key, <span style="color:#66d9ef">dynamic</span> <span style="color:#66d9ef">value</span>)&gt; ReadTwoElementAsyncLocalValueMap(<span style="color:#66d9ef">dynamic</span> storage)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">yield</span> <span style="color:#66d9ef">return</span> (storage._key1, storage._value1);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">yield</span> <span style="color:#66d9ef">return</span> (storage._key2, storage._value2);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;(<span style="color:#66d9ef">dynamic</span> key, <span style="color:#66d9ef">dynamic</span> <span style="color:#66d9ef">value</span>)&gt; ReadThreeElementAsyncLocalValueMap(<span style="color:#66d9ef">dynamic</span> storage)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">yield</span> <span style="color:#66d9ef">return</span> (storage._key1, storage._value1);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">yield</span> <span style="color:#66d9ef">return</span> (storage._key2, storage._value2);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">yield</span> <span style="color:#66d9ef">return</span> (storage._key3, storage._value3);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="from-4-to-16-values">From 4 to 16 values</h3>
<p>If a given thread stores four to sixteen values, it will thankfully stop declaring a field for every value and instead use an array-backed storage: <code>MultiElementAsyncLocalValueMap</code>. All the keys and values are stored in the <code>_keyValues</code> field as an array of <code>KeyValuePair&lt;IAsyncLocal, object&gt;</code>. The array is allocated with exactly the right size, so we just need to iterate on it to return the contents. It&rsquo;s very straightforward with DynaMD:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;(<span style="color:#66d9ef">dynamic</span> key, <span style="color:#66d9ef">dynamic</span> <span style="color:#66d9ef">value</span>)&gt; ReadMultiElementAsyncLocalValueMap(<span style="color:#66d9ef">dynamic</span> storage)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> kvp <span style="color:#66d9ef">in</span> storage._keyValues)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">yield</span> <span style="color:#66d9ef">return</span> (kvp.key, kvp.<span style="color:#66d9ef">value</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="more-than-16-values">More than 16 values</h3>
<p>To read from an <code>AsyncLocal</code> storage, the runtime has to find the value associated to a given key. Iterating on an array becomes less and less efficient as the number of values increases, so the runtime fallbacks on a <code>ManyElementAsyncLocalValueMap</code> when that number gets above 16. This type directly inherits from <code>Dictionary&lt;IAsyncLocal, object&gt;</code>, so to extract the values we need to iterate on the <code>_entries</code> field:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;(<span style="color:#66d9ef">dynamic</span> key, <span style="color:#66d9ef">dynamic</span> <span style="color:#66d9ef">value</span>)&gt; ReadManyElementAsyncLocalValueMap(<span style="color:#66d9ef">dynamic</span> storage)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> entry <span style="color:#66d9ef">in</span> storage._entries)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (entry.key != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">yield</span> <span style="color:#66d9ef">return</span> (entry.key, entry.<span style="color:#66d9ef">value</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="putting-everything-together">Putting everything together</h3>
<p>At this point, you may be wondering how everything fits together. Every time you add or remove a value from an <code>AsyncLocal</code> instance, the runtime will allocate a new storage based on the new number of elements, and copy everything from the old to the new storage. This makes adding/removing values <strong>very</strong> inefficient, so use <code>AsyncLocal</code> with care.</p>
<p>In any case, we now have helper methods for every possible <code>AsyncLocal</code> storage, so we can just call the appropriate one in our <code>ReadAsyncLocalStorage</code> method:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;(<span style="color:#66d9ef">dynamic</span> key, <span style="color:#66d9ef">dynamic</span> <span style="color:#66d9ef">value</span>)&gt; ReadAsyncLocalStorage(<span style="color:#66d9ef">dynamic</span> storage)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (storage == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Enumerable.Empty&lt;(<span style="color:#66d9ef">dynamic</span> key, <span style="color:#66d9ef">dynamic</span> <span style="color:#66d9ef">value</span>)&gt;();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ClrType type = storage.GetClrType();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> type.Name <span style="color:#66d9ef">switch</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;System.Threading.AsyncLocalValueMap+OneElementAsyncLocalValueMap&#34;</span> =&gt; ReadOneElementAsyncLocalValueMap(storage),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;System.Threading.AsyncLocalValueMap+TwoElementAsyncLocalValueMap&#34;</span> =&gt; ReadTwoElementAsyncLocalValueMap(storage),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;System.Threading.AsyncLocalValueMap+ThreeElementAsyncLocalValueMap&#34;</span> =&gt; ReadThreeElementAsyncLocalValueMap(storage),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;System.Threading.AsyncLocalValueMap+MultiElementAsyncLocalValueMap&#34;</span> =&gt; ReadMultiElementAsyncLocalValueMap(storage),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;System.Threading.AsyncLocalValueMap+ManyElementAsyncLocalValueMap&#34;</span> =&gt; ReadManyElementAsyncLocalValueMap(storage),
</span></span><span style="display:flex;"><span>        _ =&gt; <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> InvalidOperationException(<span style="color:#e6db74">$&#34;Unexpected asynclocal storage type: {type.Name}&#34;</span>)
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And that&rsquo;s it! Now we can run the program and inspect the values for every <code>AsyncLocal</code> instance.</p>


 
  
  
  
  
    
  
    
      
    
  

<div class="figure center" >
  
    <a class="fancybox" href="/images/reading-asynclocal-values-from-a-memory-dump-8be356a46b29-1.webp" data-fancybox="">
  
    <img class="fig-img" src="/images/reading-asynclocal-values-from-a-memory-dump-8be356a46b29-1.webp" >
  
    </a>
  
  
</div>

<p>The full code <a href="https://gist.github.com/kevingosse/65b310d285a201a5487c0a32a48130d7">is available here</a>.</p>

              


            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="/tags/dotnet/">dotnet</a>

  <a class="tag tag--primary tag--small" href="/tags/debugging/">debugging</a>

  <a class="tag tag--primary tag--small" href="/tags/windbg/">windbg</a>

  <a class="tag tag--primary tag--small" href="/tags/clrmd/">clrmd</a>

  <a class="tag tag--primary tag--small" href="/tags/async/">async</a>

                  </div>
                
              
            
            
<div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/finding-an-instance-of-thread-by-id-in-windbg-d9fd9a4f1bac/" data-tooltip="Finding an instance of thread by id in WinDbg" aria-label="NEXT: Finding an instance of thread by id in WinDbg">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/analyze-your-memory-dumps-in-c-with-dynamd-8e4b110b9d3a/" data-tooltip="Analyze your memory dumps in C# with DynaMD" aria-label="PREVIOUS: Analyze your memory dumps in C# with DynaMD">
          
              <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
<ul class="post-actions post-action-share" >
  
    <li class="post-action hide-lg hide-md hide-sm">
      <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
        <i class="fa fa-share-alt" aria-hidden="true"></i>
      </a>
    </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://minidump.net/reading-asynclocal-values-from-a-memory-dump-8be356a46b29/" title="Share on Twitter" aria-label="Share on Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/feed/?shareActive=true&amp;text=https://minidump.net/reading-asynclocal-values-from-a-memory-dump-8be356a46b29/" title="Share on Linkedin" aria-label="Share on Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.reddit.com/submit?url=https://minidump.net/reading-asynclocal-values-from-a-memory-dump-8be356a46b29/" title="Share on Reddit" aria-label="Share on Reddit">
          <i class="fab fa-reddit" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://news.ycombinator.com/submitlink?u=https://minidump.net/reading-asynclocal-values-from-a-memory-dump-8be356a46b29/" title="Share on Hacker News" aria-label="Share on Hacker News">
          <i class="fab fa-hacker-news" aria-hidden="true"></i>
        </a>
      </li>
    
  
  
  <li class="post-action">
    
      <a class="post-action-btn btn btn--default" href="#top" aria-label="Back to top">
      <i class="fa fa-arrow-up" aria-hidden="true"></i>
    
    </a>
  </li>
</ul>
</div>


            

<link href="https://fonts.googleapis.com/css?family=Cookie&amp;display=swap" rel="stylesheet">
<div class="bmc-btn-container"><a class="bmc-btn" target="_blank" href="https://buymeacoffee.com/kevingosse">☕<span class="bmc-btn-text">Enjoyed the article? Buy me a coffee</span></a></div>

<style>
    .bmc-btn {
        min-width: 210px;
        color: #000000;
        background-color: #FFFFFF !important;
        height: 60px;
        border-radius: 12px;
        font-size: 28px;
        font-weight: Normal;
        border: none;
        line-height: 27px;
        text-decoration: none !important;
        display: inline-flex !important;
        justify-content: center;
        align-items: center;
        font-family: 'Cookie', cursive !important;
        -webkit-box-sizing: border-box !important;
        box-sizing: border-box !important;
    }

    .bmc-btn:hover, .bmc-btn:active, .bmc-btn:focus {
        text-decoration: none !important;
        cursor: pointer;
    }

    .bmc-btn-text {
        margin-left: 8px;
        display: inline-block;
        line-height: 0;
        width: 100%;
        flex-shrink: 0;
        font-family: [FONT] !important;
    }

    .logo-outline {
        fill: #000000;
    }

    .logo-coffee {
        fill: #ffffff;
    }</style>

  
<div id="utterances">
      <noscript>Please enable JavaScript to view the comments powered by Utterances.</noscript>
    </div>
<script src="https://utteranc.es/client.js"
        repo="kevingosse/kevingosse.github.io"
        issue-term="title"
        label="comments"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
  


          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2024 Kevin Gosse. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="2">
        
<div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/finding-an-instance-of-thread-by-id-in-windbg-d9fd9a4f1bac/" data-tooltip="Finding an instance of thread by id in WinDbg" aria-label="NEXT: Finding an instance of thread by id in WinDbg">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/analyze-your-memory-dumps-in-c-with-dynamd-8e4b110b9d3a/" data-tooltip="Analyze your memory dumps in C# with DynaMD" aria-label="PREVIOUS: Analyze your memory dumps in C# with DynaMD">
          
              <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
<ul class="post-actions post-action-share" >
  
    <li class="post-action hide-lg hide-md hide-sm">
      <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
        <i class="fa fa-share-alt" aria-hidden="true"></i>
      </a>
    </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://minidump.net/reading-asynclocal-values-from-a-memory-dump-8be356a46b29/" title="Share on Twitter" aria-label="Share on Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/feed/?shareActive=true&amp;text=https://minidump.net/reading-asynclocal-values-from-a-memory-dump-8be356a46b29/" title="Share on Linkedin" aria-label="Share on Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.reddit.com/submit?url=https://minidump.net/reading-asynclocal-values-from-a-memory-dump-8be356a46b29/" title="Share on Reddit" aria-label="Share on Reddit">
          <i class="fab fa-reddit" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://news.ycombinator.com/submitlink?u=https://minidump.net/reading-asynclocal-values-from-a-memory-dump-8be356a46b29/" title="Share on Hacker News" aria-label="Share on Hacker News">
          <i class="fab fa-hacker-news" aria-hidden="true"></i>
        </a>
      </li>
    
  
  
  <li class="post-action">
    
      <a class="post-action-btn btn btn--default" href="#top" aria-label="Back to top">
      <i class="fa fa-arrow-up" aria-hidden="true"></i>
    
    </a>
  </li>
</ul>
</div>


      </div>
      
<div id="share-options-bar" class="share-options-bar" data-behavior="2">
  <i id="btn-close-shareoptions" class="fa fa-times"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fminidump.net%2Freading-asynclocal-values-from-a-memory-dump-8be356a46b29%2F" aria-label="Share on Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/feed/?shareActive=true&amp;text=https%3A%2F%2Fminidump.net%2Freading-asynclocal-values-from-a-memory-dump-8be356a46b29%2F" aria-label="Share on Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i><span>Share on Linkedin</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.reddit.com/submit?url=https%3A%2F%2Fminidump.net%2Freading-asynclocal-values-from-a-memory-dump-8be356a46b29%2F" aria-label="Share on Reddit">
          <i class="fab fa-reddit" aria-hidden="true"></i><span>Share on Reddit</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fminidump.net%2Freading-asynclocal-values-from-a-memory-dump-8be356a46b29%2F" aria-label="Share on Hacker News">
          <i class="fab fa-hacker-news" aria-hidden="true"></i><span>Share on Hacker News</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>


    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-times"></i>
    </div>
    
      <img id="about-card-picture" src="https://minidump.net/images/profile.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Kevin Gosse</h4>
    
      <div id="about-card-bio">Kevin Gosse has been using Microsoft .NET technologies for more than 15 years, across client, server, and mobile applications. Passionate about debugging. He is Microsoft MVP and is currently employed at Datadog, where he works on the performance of the .NET APM.</div>
    
    
    
  </div>
</div>

    

    
  
    
      <div id="cover" style="background-image:url('https://minidump.net/images/code.png');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js" integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://minidump.net/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js"></script>



<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>




    
  </body>
</html>

