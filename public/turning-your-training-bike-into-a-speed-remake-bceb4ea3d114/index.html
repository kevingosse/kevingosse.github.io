<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <script type="application/ld+json">

{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Turning your training bike into a Speed remake",
  
  "image": "https://minidump.net/images/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114-5.webp",
  
  "datePublished": "2020-04-14T00:00:00Z",
  "dateModified": "2020-04-14T00:00:00Z",
  "author": {
    "@type": "Person",
    "name": "Kevin Gosse",
    
    "image": "https://minidump.net/images/profile.png"
    
  },
  "mainEntityOfPage": { 
    "@type": "WebPage",
    "@id": "https:\/\/minidump.net\/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114\/" 
  },
  "publisher": {
    "@type": "Organization",
    "name": "minidump.net",
    
    "logo": {
      "@type": "ImageObject",
      "url": "https://minidump.net/images/profile.png"
    }
    
  },
  "description": "Inspiration for quarantine days: how to connect a Raspberry Pi to a training bike to stream the speed to a computer and pause a video when below 20 km/h",
  "keywords": []
}

</script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.121.1 with theme Tranquilpeak 0.5.3-BETA">
<meta name="author" content="Kevin Gosse">
<meta name="keywords" content="">
<meta name="description" content="Inspiration for quarantine days: how to connect a Raspberry Pi to a training bike to stream the speed to a computer and pause a video when below 20 km/h">


<meta property="og:description" content="Inspiration for quarantine days: how to connect a Raspberry Pi to a training bike to stream the speed to a computer and pause a video when below 20 km/h">
<meta property="og:type" content="article">
<meta property="og:title" content="Turning your training bike into a Speed remake">
<meta name="twitter:title" content="Turning your training bike into a Speed remake">
<meta property="og:url" content="https://minidump.net/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114/">
<meta property="twitter:url" content="https://minidump.net/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114/">
<meta property="og:site_name" content="minidump.net">
<meta property="og:description" content="Inspiration for quarantine days: how to connect a Raspberry Pi to a training bike to stream the speed to a computer and pause a video when below 20 km/h">
<meta name="twitter:description" content="Inspiration for quarantine days: how to connect a Raspberry Pi to a training bike to stream the speed to a computer and pause a video when below 20 km/h">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2020-04-14T00:00:00">
  
  
    <meta property="article:modified_time" content="2020-04-14T00:00:00">
  
  
  
  
    
      <meta property="article:tag" content="dotnet">
    
      <meta property="article:tag" content="raspberry-pi">
    
      <meta property="article:tag" content="iot">
    
  


<meta name="twitter:card" content="summary">

  <meta name="twitter:site" content="@kookiz">


  <meta name="twitter:creator" content="@kookiz">






  <meta property="og:image" content="https://minidump.net/images/profile.png">
  <meta property="twitter:image" content="https://minidump.net/images/profile.png">





  <meta property="og:image" content="https://minidump.net/images/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114-5.webp">
  <meta property="twitter:image" content="https://minidump.net/images/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114-5.webp">


    <title>Turning your training bike into a Speed remake</title>

    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    

    

    <link rel="canonical" href="https://minidump.net/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    
    
    <link rel="stylesheet" href="https://minidump.net/css/style-h6ccsoet3mzkbb0wngshlfbaweimexgqcxj0h5hu4h82olsdzz6wmqdkajm.min.css" />
    
    

    
      
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MQCXFBVCCM"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-MQCXFBVCCM', { 'anonymize_ip': false });
}
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="2">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="/" aria-label="Go to homepage">minidump.net</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="2">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="/#about" aria-label="Read more about the author">
          <img class="sidebar-profile-picture" src="https://minidump.net/images/profile.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Kevin Gosse</h4>
        
          <h5 class="sidebar-profile-bio">Kevin Gosse has been using Microsoft .NET technologies for more than 15 years, across client, server, and mobile applications. Passionate about debugging. He is Microsoft MVP and is currently employed at Datadog, where he works on the performance of the .NET APM.</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/" title="Home">
    
      <i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/tags" title="Tags">
    
      <i class="sidebar-button-icon fas fa-lg fa-tags" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/archives" title="Archives">
    
      <i class="sidebar-button-icon fas fa-lg fa-archive" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/#about" title="About">
    
      <i class="sidebar-button-icon fas fa-lg fa-question" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/kookiz" target="_blank" rel="noopener" title="Twitter">
    
      <i class="sidebar-button-icon fab fa-lg fa-twitter" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/kevingosse" target="_blank" rel="noopener" title="GitHub">
    
      <i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/index.xml" title="RSS">
    
      <i class="sidebar-button-icon fas fa-lg fa-rss" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.buymeacoffee.com/kevingosse" target="_blank" rel="noopener" title="Buy me a coffee">
    
      <i class="sidebar-button-icon fas fa-lg fa-coffee" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Buy me a coffee</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="2"
        class="
               hasCoverMetaIn
               ">
        <article class="post" id="top">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title">
      Turning your training bike into a Speed remake
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2020-04-14T00:00:00Z">
        
  
  
  
  
    April 14 2020
  

      </time>
    
    
  </div>

</div>
          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              <p><em>(for context, this article was written during the containment period in 2020)</em></p>
<p>In those days of isolation, finding ways to get a regular physical activity is important, both for health and moral. It turns out that I own a training bike, so it was a good opportunity to take it back from wherever it had been stored for years (yeah, like <em>you</em> kept using it).</p>
<p>I tend to use the bike while watching series to make it less boring. But I noticed that, when getting to the climax of a good episode, one tends to forget about the bike and unconsciously slows down. So I thought of an amusing way to fix that.</p>


 
  
  
  
  
    
  
    
      
    
  

<div class="figure center" >
  
    <a class="fancybox" href="/images/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114-1.webp" data-fancybox="">
  
    <img class="fig-img" src="/images/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114-1.webp" >
  
    </a>
  
  
</div>

<p>Remember the most famous part of the Speed movie? A bus is rigged with a bomb that explodes if it moves slower than 50 mph. What if we stole the concept?</p>
<p>Of course, I do not wish my training bike to explode, mostly for practical reasons. Instead, I would like the video to automatically pause when I get below the threshold, providing an immediate incentive to pedal harder. And so I built just that.</p>


 
  
  
  
  
    
  
    
      
    
  

<div class="figure center" >
  
    <a class="fancybox" href="/images/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114-2.webp" data-fancybox="">
  
    <img class="fig-img" src="/images/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114-2.webp" >
  
    </a>
  
  
</div>

<p>The setup uses a Raspberry Pi to read the speed from the bike and send it to the computer. There, an application takes care of playing/pausing the video as needed.</p>
<p>The very first step was finding how to read the speed. The speed counter of my training bike is connected using a simple 2-pins connector.</p>


 
  
  
  
  
    
  
    
      
    
  

<div class="figure center" >
  
    <a class="fancybox" href="/images/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114-3.webp" data-fancybox="">
  
    <img class="fig-img" src="/images/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114-3.webp" >
  
    </a>
  
  
</div>

<p>Fortunately, those things are pretty standard, and you can use <a href="https://www.amazon.com/Semoic-Female-Dupont-Arduino-Breadboard/dp/B07MW1M4RL/">any breadboard cable</a> to connect the pins. The next question is: where to plug them?</p>
<p>The Raspberry Pi has a set of pins called GPIO (for general-purpose input/output) that you can use for all kinds of things. Not all pins are created equal, so you must make sure to pick the right one depending on what you&rsquo;re trying to do:</p>


 
  
  
  
  
    
  
    
      
    
  

<div class="figure center" >
  
    <a class="fancybox" href="/images/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114-4.webp" data-fancybox="">
  
    <img class="fig-img" src="/images/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114-4.webp" >
  
    </a>
  
  
</div>

<p>To pick the right pins, we need to clarify what we&rsquo;re doing. I&rsquo;ve already seen bike speedometers in the past, and they worked by having a magnet attached to the wheel and a detector attached to the frame. As the wheel is turning, when the magnet gets close to the detector, it triggers a switch that closes the circuit. Then it&rsquo;s just a matter of counting the time between each of those impulses and deducing the speed (by knowing the size of the wheel).</p>
<p>I assumed that my training bike worked the same way. So I plugged one pin of the bike connector to the 3.3V of the Raspberry (pin 1), and the other to a GPIO pin (pin 7). My expectation was that, as the training bike internal wheel turned, it would close the circuit and I would be able to read the 3.3V impulses on the GPIO pin.</p>
<p>That&rsquo;s great, but to read those impulses we need some software. I tried playing a little bit with Windows 10 IoT, but it doesn&rsquo;t support the Raspberry Pi properly and I ended up using <a href="https://www.raspberrypi.org/downloads/raspbian/">Raspbian</a> instead. If like me you don&rsquo;t feel like plugging a keyboard and a screen to the Raspberry, there are great tutorials out there explaining how to prepare an SD card with a Raspbian that automatically starts an SSH daemon.</p>
<p>For the code itself, I decided to use .NET Core, since it supports reading/writing from GPIO pins using the <a href="https://www.nuget.org/packages/System.Device.Gpio/1.0.0">System.Device.Gpio NuGet package</a>.</p>
<p>To control the pins, you first need to instantiate a <code>GpioController</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> controller = <span style="color:#66d9ef">new</span> GpioController(PinNumberingScheme.Board);
</span></span></code></pre></div><p>You can then open a pin and start listening to any change:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> pin = <span style="color:#ae81ff">11</span>;
</span></span><span style="display:flex;"><span>controller.OpenPin(pin, PinMode.Input);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>controller.RegisterCallbackForPinValueChangedEvent(pin, PinEventTypes.Rising | PinEventTypes.Falling,
</span></span><span style="display:flex;"><span>  (s, e) =&gt; Console.WriteLine(e.ChangeType));
</span></span></code></pre></div><p>At least, that&rsquo;s what I thought. But after launching the program, I started receiving a continuous stream of <code>Rising</code>/<code>Falling</code> events even though I wasn&rsquo;t touching the bike! After a bit of poking around, I noticed two things:</p>
<ul>
<li>
<p>The events would be triggered at a very precise rate of 50 per second</p>
</li>
<li>
<p>The events were triggered only when the circuit was open. When I moved the pedals in position to close the circuit, the events would stop</p>
</li>
</ul>
<p>I have only a cursory understanding of this, <a href="https://docs.microsoft.com/en-us/uwp/api/windows.devices.gpio.gpiopindrivemode?view=winrt-19041&amp;WT.mc_id=DT-MVP-5003493">but from what I read</a> it seems that when setting the pin mode to <code>Input</code>, it&rsquo;s connected to nothing. Therefore, when the circuit is open and we try to read the value, it picks up residual noise (I suspect the 50 Hz is due to interference caused by the AC input, but don&rsquo;t quote me on this). Instead, we need to use <code>InputPullDown</code>, which will ground the pin and properly read nothing when the circuit is open. After those changes, the events were properly captured, so the next step was to compute the actual speed.</p>
<p>On a real bike, it would just be a matter of measuring the size of the wheel and deducing how much distance is covered for one rotation. But on a training bike, we don&rsquo;t have a wheel we can measure, so we must figure out what value the internal counter is using.</p>
<p>One way could be to use the bike, try to pedal at a constant speed, and read the value on the internal counter. Then plug the Raspberry, pedal at the same speed, compute the frequency, and deduce everything we need. This could work but it would be very approximate, as it&rsquo;s difficult to pedal at a constant speed. Instead, I decided to plug the Raspberry directly to the counter and use it to simulate the bike. This way, we can send impulses at the frequency we want and read the speed on the counter. To plug the Raspberry to the counter, I simply connected one pin of the counter on a GPIO pin, and the other to the ground. Then I wrote some code to send the impulses at the desired frequency by using <code>GpioController.Write</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> TestSpeed(GpioController controller)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> pin = <span style="color:#ae81ff">36</span>;
</span></span><span style="display:flex;"><span>    controller.OpenPin(pin, PinMode.Output);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> delay = <span style="color:#ae81ff">500</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Console.WriteLine(<span style="color:#e6db74">&#34;Started&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Task.Run(() =&gt;
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            controller.Write(pin, PinValue.High);
</span></span><span style="display:flex;"><span>            Thread.Sleep(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>            controller.Write(pin, PinValue.Low);
</span></span><span style="display:flex;"><span>            Thread.Sleep(delay);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> rawValue = Console.ReadLine();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">int</span>.TryParse(rawValue, <span style="color:#66d9ef">out</span> <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">value</span>))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            delay = <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>            Console.WriteLine(<span style="color:#e6db74">$&#34;Delay set to {delay} (frequency: {1000 / delay} hz&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>At one impulse per second, the counter shows a speed of 16 km/h. Therefore, to compute the speed in km/h in our own setup, we need to compute the frequency in Hz of the impulses and multiply it by 16. Great.</p>
<p>Before moving on, I couldn&rsquo;t resist having a bit of fun.</p>


 
  
  
  
  
    
  
    
      
    
  

<div class="figure center" >
  
    <a class="fancybox" href="/images/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114-5.webp" title="Without breaking a sweat" data-fancybox="">
  
    <img class="fig-img" src="/images/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114-5.webp"  alt="Without breaking a sweat">
  
    </a>
  
   
    <span class="caption">Without breaking a sweat</span>
  
</div>

<p>The maximum value that the counter can display is, as we could expect, 999.9 km/h. If I further increase the frequency, it overflows at around 2000 km/h (maybe 2048, my setup is not precise enough) and counts back from 0.</p>
<p>Ok, moving back to the serious stuff. I decided to keep the Raspberry plugged to both the bike and the counter so that I could capture the current speed and keep displaying it on the counter. The final code to compute the speed looks like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> controller = <span style="color:#66d9ef">new</span> GpioController(PinNumberingScheme.Board);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> sw = <span style="color:#66d9ef">new</span> Stopwatch();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> pin = <span style="color:#ae81ff">11</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> outputPin = <span style="color:#ae81ff">36</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>controller.OpenPin(outputPin, PinMode.Output);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>controller.OpenPin(pin);
</span></span><span style="display:flex;"><span>controller.SetPinMode(pin, PinMode.InputPullDown);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>controller.RegisterCallbackForPinValueChangedEvent(pin, PinEventTypes.Rising | PinEventTypes.Falling,
</span></span><span style="display:flex;"><span>    (s, e) =&gt;
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (e.ChangeType == PinEventTypes.Falling)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            _controller.Write(outputPin, PinValue.Low);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            _controller.Write(outputPin, PinValue.High);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (!sw.IsRunning)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                sw.Start();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">var</span> elapsed = sw.Elapsed;
</span></span><span style="display:flex;"><span>                sw.Restart();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">var</span> rotationsPerSecond = <span style="color:#ae81ff">1.0</span> / elapsed.TotalSeconds;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">double</span> speed = rotationsPerSecond * <span style="color:#ae81ff">16</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                Console.WriteLine(<span style="color:#e6db74">$&#34;Speed: {speed} km/h&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span></code></pre></div><p>The next step was to send that data to the computer. I could simply return the current speed on a web page and poll it from my computer but hey, the year is 2020. To get about one value per second, we totally need some push technology, so I decided to use SignalR.</p>
<blockquote>
<p>I actually started by thinking that SignalR was overkill and tried using raw web sockets instead. It seemed to work at first, but I quickly discovered that stuff we take as granted, such as detection of disconnections, isn&rsquo;t available out of the box. So yeah, use SignalR instead.</p>
</blockquote>
<p>For the implementation, I wrote a <code>IHostedService</code> that computes the current speed, and push it to the SignalR hub. It worked fine but I later discovered a problem: since I was waiting for inputs on the GPIO to compute the speed, if I suddenly stopped pedaling then the speed would stop being updated and would remain at its latest value. It kinda defeated the whole purpose of the project. So I added a background thread that monitors the time since the last speed update and assumes a speed of 0 km/h after 3 seconds without any change.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SpeedCounter</span> : IHostedService
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> IHubContext&lt;SpeedHub&gt; _hub;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> GpioController _controller;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> SpeedCounter(IHubContext&lt;SpeedHub&gt; hub)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        _hub = hub;
</span></span><span style="display:flex;"><span>        _controller = <span style="color:#66d9ef">new</span> GpioController(PinNumberingScheme.Board);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Task StartAsync(CancellationToken cancellationToken)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> pin = <span style="color:#ae81ff">11</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> outputPin = <span style="color:#ae81ff">36</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        _controller.OpenPin(outputPin, PinMode.Output);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        _controller.OpenPin(pin);
</span></span><span style="display:flex;"><span>        _controller.SetPinMode(pin, PinMode.InputPullDown);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> sw = <span style="color:#66d9ef">new</span> Stopwatch();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> lastUpdate = DateTime.UtcNow;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        _controller.RegisterCallbackForPinValueChangedEvent(pin, PinEventTypes.Rising | PinEventTypes.Falling,
</span></span><span style="display:flex;"><span>            (s, e) =&gt;
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (e.ChangeType == PinEventTypes.Falling)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    _controller.Write(outputPin, PinValue.Low);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    _controller.Write(outputPin, PinValue.High);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (!sw.IsRunning)
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        sw.Start();
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">var</span> elapsed = sw.Elapsed;
</span></span><span style="display:flex;"><span>                        sw.Restart();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                        lastUpdate = DateTime.UtcNow;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">var</span> rotationsPerSecond = <span style="color:#ae81ff">1.0</span> / elapsed.TotalSeconds;
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">double</span> speed = rotationsPerSecond * <span style="color:#ae81ff">16</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                        _ = _hub.Clients.All.SendAsync(<span style="color:#e6db74">&#34;SendSpeed&#34;</span>, speed);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                        Console.WriteLine(<span style="color:#e6db74">$&#34;Speed: {speed} km/h&#34;</span>);
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        _ = Task.Run(<span style="color:#66d9ef">async</span> () =&gt;
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">await</span> Task.Delay(<span style="color:#ae81ff">1000</span>, cancellationToken);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> ((DateTime.UtcNow - lastUpdate).TotalSeconds &gt; <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    _ = _hub.Clients.All.SendAsync(<span style="color:#e6db74">&#34;SendSpeed&#34;</span>, <span style="color:#ae81ff">0</span>, cancellationToken);
</span></span><span style="display:flex;"><span>                    Console.WriteLine(<span style="color:#e6db74">$&#34;No update detected, assuming 0&#34;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }, cancellationToken);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Task.CompletedTask;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Task StopAsync(CancellationToken cancellationToken)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        _controller.Dispose();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Task.CompletedTask;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SpeedHub</span> : Hub
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Program</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> Main(<span style="color:#66d9ef">string</span>[] args)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> host = <span style="color:#66d9ef">new</span> WebHostBuilder()
</span></span><span style="display:flex;"><span>            .UseKestrel()
</span></span><span style="display:flex;"><span>            .UseUrls(<span style="color:#e6db74">&#34;http://*:5000/&#34;</span>)
</span></span><span style="display:flex;"><span>            .UseStartup&lt;Startup&gt;()
</span></span><span style="display:flex;"><span>            .Build();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        host.Start();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Console.WriteLine(<span style="color:#e6db74">&#34;Started&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        host.WaitForShutdown();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>What about the client-side? The goal was to start playing a video when the speed got above a threshold and stop it when it got below. Most video players (including web ones) use the spacebar as a shortcut to pause/resume the video, so all I did was sending the spacebar input to the focused application when the speed got above or below the threshold.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> HubConnection _connection;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> _threshold = <span style="color:#ae81ff">20</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">bool</span> _isAboveThreshold;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> MainWindow()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    InitializeComponent();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">void</span> ButtonConnect_Click(<span style="color:#66d9ef">object</span> sender, RoutedEventArgs e)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> ip = TextIp.Text;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    _connection = <span style="color:#66d9ef">new</span> HubConnectionBuilder()
</span></span><span style="display:flex;"><span>        .WithAutomaticReconnect()
</span></span><span style="display:flex;"><span>        .WithUrl(<span style="color:#e6db74">$&#34;http://{ip}:5000/speed&#34;</span>)
</span></span><span style="display:flex;"><span>        .Build();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> _connection.StartAsync();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">catch</span> (Exception ex)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        MessageBox.Show(<span style="color:#e6db74">&#34;Connection failed: &#34;</span> + ex);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> _connection.DisposeAsync();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    _connection.On&lt;<span style="color:#66d9ef">double</span>&gt;(<span style="color:#e6db74">&#34;SendSpeed&#34;</span>, speed =&gt; { _ = UpdateSpeed(speed); });
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">async</span> UiOperation UpdateSpeed(<span style="color:#66d9ef">double</span> speed)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    LabelSpeed.Text = Math.Round(speed, <span style="color:#ae81ff">0</span>, MidpointRounding.AwayFromZero).ToString();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (speed &gt;= _threshold &amp;&amp; !_isAboveThreshold)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        _isAboveThreshold = <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        SendKeys.SendWait(<span style="color:#e6db74">&#34; &#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (speed &lt; _threshold &amp;&amp; _isAboveThreshold)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        _isAboveThreshold = <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>        SendKeys.SendWait(<span style="color:#e6db74">&#34; &#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I also used <a href="https://lvcharts.net/">LiveCharts.Wpf</a> to display the speed on a nice chart.</p>


 
  
  
  
  
    
  
    
      
    
  

<div class="figure center" >
  
    <a class="fancybox" href="/images/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114-6.webp" title="It&#39;s ugly but you&#39;re supposed to watch the video anyway" data-fancybox="">
  
    <img class="fig-img" src="/images/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114-6.webp"  alt="It&#39;s ugly but you&#39;re supposed to watch the video anyway">
  
    </a>
  
   
    <span class="caption">It&#39;s ugly but you&#39;re supposed to watch the video anyway</span>
  
</div>

<p>For the finishing touches, I attached the Raspberry to the bike and configured it to launch the application at startup. The Raspberry takes a few seconds to start when powered on, so I looked for a way to get visual feedback when the application is loaded and ready to send the speed. The only way I could think of was to use the on-board LEDs, and fortunately, it turns out that they can be controlled programmatically. To turn on the green LED, just write <code>1</code> to the <code>/sys/class/leds/led0/brightness</code> file. To turn it off, write <code>0</code>. To restore the default behavior (have the LED blink on disk access), write <code>mmc0</code> to <code>/sys/class/leds/led0/trigger</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> Blink()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (!_isClientConnected)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        File.WriteAllText(<span style="color:#e6db74">&#34;/sys/class/leds/led0/brightness&#34;</span>, <span style="color:#e6db74">&#34;0&#34;</span>);
</span></span><span style="display:flex;"><span>        Thread.Sleep(<span style="color:#ae81ff">500</span>);
</span></span><span style="display:flex;"><span>        File.WriteAllText(<span style="color:#e6db74">&#34;/sys/class/leds/led0/brightness&#34;</span>, <span style="color:#e6db74">&#34;1&#34;</span>);
</span></span><span style="display:flex;"><span>        Thread.Sleep(<span style="color:#ae81ff">500</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    File.WriteAllText(<span style="color:#e6db74">&#34;/sys/class/leds/led0/brightness&#34;</span>, <span style="color:#e6db74">&#34;0&#34;</span>);
</span></span><span style="display:flex;"><span>    File.WriteAllText(<span style="color:#e6db74">&#34;/sys/class/leds/led0/trigger&#34;</span>, <span style="color:#e6db74">&#34;mmc0&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>With that, my setup was complete, and I could go back to <a href="https://twitter.com/KooKiz/status/1246861136076685318">finding excuses not to use the bike</a>.</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Current status <a href="https://t.co/Hhw1f0vlKq">pic.twitter.com/Hhw1f0vlKq</a></p>&mdash; Kevin Gosse (@KooKiz) <a href="https://twitter.com/KooKiz/status/1246861136076685318?ref_src=twsrc%5Etfw">April 5, 2020</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>



              


            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="/tags/dotnet/">dotnet</a>

  <a class="tag tag--primary tag--small" href="/tags/raspberry-pi/">raspberry-pi</a>

  <a class="tag tag--primary tag--small" href="/tags/iot/">iot</a>

                  </div>
                
              
            
            
<div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/net-threadpool-starvation-and-how-queuing-makes-it-worse-512c8d570527/" data-tooltip=".NET ThreadPool starvation, and how queuing makes it worse" aria-label="NEXT: .NET ThreadPool starvation, and how queuing makes it worse">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/switching-back-to-the-ui-thread-in-wpf-uwp-in-modern-c-5dc1cc8efa5e/" data-tooltip="Switching back to the UI thread in WPF/UWP, in modern C#" aria-label="PREVIOUS: Switching back to the UI thread in WPF/UWP, in modern C#">
          
              <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
<ul class="post-actions post-action-share" >
  
    <li class="post-action hide-lg hide-md hide-sm">
      <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
        <i class="fa fa-share-alt" aria-hidden="true"></i>
      </a>
    </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://minidump.net/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114/" title="Share on Twitter" aria-label="Share on Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/feed/?shareActive=true&amp;text=https://minidump.net/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114/" title="Share on Linkedin" aria-label="Share on Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.reddit.com/submit?url=https://minidump.net/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114/" title="Share on Reddit" aria-label="Share on Reddit">
          <i class="fab fa-reddit" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://news.ycombinator.com/submitlink?u=https://minidump.net/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114/" title="Share on Hacker News" aria-label="Share on Hacker News">
          <i class="fab fa-hacker-news" aria-hidden="true"></i>
        </a>
      </li>
    
  
  
  <li class="post-action">
    
      <a class="post-action-btn btn btn--default" href="#top" aria-label="Back to top">
      <i class="fa fa-arrow-up" aria-hidden="true"></i>
    
    </a>
  </li>
</ul>
</div>


            

<link href="https://fonts.googleapis.com/css?family=Cookie&amp;display=swap" rel="stylesheet">
<div class="bmc-btn-container"><a class="bmc-btn" target="_blank" href="https://buymeacoffee.com/kevingosse">☕<span class="bmc-btn-text">Enjoyed the article? Buy me a coffee</span></a></div>

<style>
    .bmc-btn {
        min-width: 210px;
        color: #000000;
        background-color: #FFFFFF !important;
        height: 60px;
        border-radius: 12px;
        font-size: 28px;
        font-weight: Normal;
        border: none;
        line-height: 27px;
        text-decoration: none !important;
        display: inline-flex !important;
        justify-content: center;
        align-items: center;
        font-family: 'Cookie', cursive !important;
        -webkit-box-sizing: border-box !important;
        box-sizing: border-box !important;
    }

    .bmc-btn:hover, .bmc-btn:active, .bmc-btn:focus {
        text-decoration: none !important;
        cursor: pointer;
    }

    .bmc-btn-text {
        margin-left: 8px;
        display: inline-block;
        line-height: 0;
        width: 100%;
        flex-shrink: 0;
        font-family: [FONT] !important;
    }

    .logo-outline {
        fill: #000000;
    }

    .logo-coffee {
        fill: #ffffff;
    }</style>

  
<div id="utterances">
      <noscript>Please enable JavaScript to view the comments powered by Utterances.</noscript>
    </div>
<script src="https://utteranc.es/client.js"
        repo="kevingosse/kevingosse.github.io"
        issue-term="title"
        label="comments"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
  


          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2024 Kevin Gosse. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="2">
        
<div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/net-threadpool-starvation-and-how-queuing-makes-it-worse-512c8d570527/" data-tooltip=".NET ThreadPool starvation, and how queuing makes it worse" aria-label="NEXT: .NET ThreadPool starvation, and how queuing makes it worse">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="/switching-back-to-the-ui-thread-in-wpf-uwp-in-modern-c-5dc1cc8efa5e/" data-tooltip="Switching back to the UI thread in WPF/UWP, in modern C#" aria-label="PREVIOUS: Switching back to the UI thread in WPF/UWP, in modern C#">
          
              <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
<ul class="post-actions post-action-share" >
  
    <li class="post-action hide-lg hide-md hide-sm">
      <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
        <i class="fa fa-share-alt" aria-hidden="true"></i>
      </a>
    </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://minidump.net/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114/" title="Share on Twitter" aria-label="Share on Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/feed/?shareActive=true&amp;text=https://minidump.net/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114/" title="Share on Linkedin" aria-label="Share on Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.reddit.com/submit?url=https://minidump.net/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114/" title="Share on Reddit" aria-label="Share on Reddit">
          <i class="fab fa-reddit" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://news.ycombinator.com/submitlink?u=https://minidump.net/turning-your-training-bike-into-a-speed-remake-bceb4ea3d114/" title="Share on Hacker News" aria-label="Share on Hacker News">
          <i class="fab fa-hacker-news" aria-hidden="true"></i>
        </a>
      </li>
    
  
  
  <li class="post-action">
    
      <a class="post-action-btn btn btn--default" href="#top" aria-label="Back to top">
      <i class="fa fa-arrow-up" aria-hidden="true"></i>
    
    </a>
  </li>
</ul>
</div>


      </div>
      
<div id="share-options-bar" class="share-options-bar" data-behavior="2">
  <i id="btn-close-shareoptions" class="fa fa-times"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fminidump.net%2Fturning-your-training-bike-into-a-speed-remake-bceb4ea3d114%2F" aria-label="Share on Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/feed/?shareActive=true&amp;text=https%3A%2F%2Fminidump.net%2Fturning-your-training-bike-into-a-speed-remake-bceb4ea3d114%2F" aria-label="Share on Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i><span>Share on Linkedin</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.reddit.com/submit?url=https%3A%2F%2Fminidump.net%2Fturning-your-training-bike-into-a-speed-remake-bceb4ea3d114%2F" aria-label="Share on Reddit">
          <i class="fab fa-reddit" aria-hidden="true"></i><span>Share on Reddit</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fminidump.net%2Fturning-your-training-bike-into-a-speed-remake-bceb4ea3d114%2F" aria-label="Share on Hacker News">
          <i class="fab fa-hacker-news" aria-hidden="true"></i><span>Share on Hacker News</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>


    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-times"></i>
    </div>
    
      <img id="about-card-picture" src="https://minidump.net/images/profile.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Kevin Gosse</h4>
    
      <div id="about-card-bio">Kevin Gosse has been using Microsoft .NET technologies for more than 15 years, across client, server, and mobile applications. Passionate about debugging. He is Microsoft MVP and is currently employed at Datadog, where he works on the performance of the .NET APM.</div>
    
    
    
  </div>
</div>

    

    
  
    
      <div id="cover" style="background-image:url('https://minidump.net/images/code.png');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js" integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://minidump.net/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js"></script>



<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>




    
  </body>
</html>

