<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <script type="application/ld+json">

{  
  "@context":"http://schema.org",
  "@type":"Website",
  "@id":"https:\/\/minidump.net\/",
  "author": {
    "@type": "Person",
    "name": "Kevin Gosse",
    
    "image": "https://minidump.net/images/profile.png"
    
  },
  "name":"minidump.net",
  "description":"",
  "url":"https:\/\/minidump.net\/tags\/performance\/",
  "keywords":"[]"
}

</script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.121.1 with theme Tranquilpeak 0.5.3-BETA">
<meta name="author" content="Kevin Gosse">
<meta name="keywords" content="">
<meta name="description" content="">


<meta property="og:description" content="">
<meta property="og:type" content="website">
<meta property="og:title" content="performance">
<meta name="twitter:title" content="performance">
<meta property="og:url" content="https://minidump.net/tags/performance/">
<meta property="twitter:url" content="https://minidump.net/tags/performance/">
<meta property="og:site_name" content="minidump.net">
<meta property="og:description" content="">
<meta name="twitter:description" content="">
<meta property="og:locale" content="en-us">


<meta name="twitter:card" content="summary">

  <meta name="twitter:site" content="@kookiz">


  <meta name="twitter:creator" content="@kookiz">






  <meta property="og:image" content="https://minidump.net/images/profile.png">
  <meta property="twitter:image" content="https://minidump.net/images/profile.png">






    <title>performance</title>

    <link rel="icon" href="/favicon.png">
    
      <link rel="alternate" type="application/rss+xml" title="RSS" href="/tags/performance/index.xml">
    

    

    <link rel="canonical" href="https://minidump.net/tags/performance/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    
    
    <link rel="stylesheet" href="https://minidump.net/css/style-h6ccsoet3mzkbb0wngshlfbaweimexgqcxj0h5hu4h82olsdzz6wmqdkajm.min.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="2">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="/" aria-label="Go to homepage">minidump.net</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="2">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="/#about" aria-label="Read more about the author">
          <img class="sidebar-profile-picture" src="https://minidump.net/images/profile.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Kevin Gosse</h4>
        
          <h5 class="sidebar-profile-bio">Kevin Gosse has been using Microsoft .NET technologies for more than 15 years, across client, server, and mobile applications. Passionate about debugging. He is Microsoft MVP and is currently employed at Datadog, where he works on the performance of the .NET APM.</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/" title="Home">
    
      <i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/categories" title="Categories">
    
      <i class="sidebar-button-icon fas fa-lg fa-bookmark" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/tags" title="Tags">
    
      <i class="sidebar-button-icon fas fa-lg fa-tags" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/archives" title="Archives">
    
      <i class="sidebar-button-icon fas fa-lg fa-archive" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/#about" title="About">
    
      <i class="sidebar-button-icon fas fa-lg fa-question" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/kookiz" target="_blank" rel="noopener" title="Twitter">
    
      <i class="sidebar-button-icon fab fa-lg fa-twitter" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/kevingosse" target="_blank" rel="noopener" title="GitHub">
    
      <i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/index.xml" title="RSS">
    
      <i class="sidebar-button-icon fas fa-lg fa-rss" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.buymeacoffee.com/kevingosse" target="_blank" rel="noopener" title="Buy me a coffee">
    
      <i class="sidebar-button-icon fas fa-lg fa-coffee" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Buy me a coffee</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      
        

      
      <div id="main" data-behavior="2"
        class="
               hasCoverMetaIn
               ">
        
          <section class="postShorten-group main-content-wrap">
            
            
              
  
    
  


  

<article class="postShorten postShorten--thumbnailimg-bottom">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="https://minidump.net/memory-alignment-of-doubles-in-c-1d13e3ce741/" aria-label="Open the post: Memory alignment of doubles in C#">
      
          Memory alignment of doubles in C#
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2023-09-30T00:00:00Z">
        
  
  
  
  
    September 30 2023
  

      </time>
    
    
  </div>

    </div>
    <div class="postShorten-excerpt">
      
        A while ago, I mentioned on Twitter an interesting quirk of objects in .NET: when running in 64 bits, objects are aligned on a 8-bytes boundary despite having a 32 bits header, and therefore 32 bits are &ldquo;lost&rdquo; before each object:
It bothers me so much that on #dotnet on 64-bit, 4 bytes are wasted for *every class instance* because objects are aligned on a 8 bytes boundary and the header has a fixed size of 4 bytes.
      
      <p>
        
          <a href="https://minidump.net/memory-alignment-of-doubles-in-c-1d13e3ce741/" class="postShorten-excerpt_link link" aria-label="Open the post: Memory alignment of doubles in C#">Continue reading</a>
        
        
      </p>
    </div>
  </div>
  
    <a href="https://minidump.net/memory-alignment-of-doubles-in-c-1d13e3ce741/" aria-label="Open the post: Memory alignment of doubles in C#">
      <div class="postShorten-thumbnailimg">
        <img alt="" src="https://minidump.net/images/memory-alignment-of-doubles-in-c-1d13e3ce741-1.webp"/>
      </div>
    </a>
  
</article>

            
              
  
    
  


  

<article class="postShorten postShorten--thumbnailimg-bottom">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="https://minidump.net/suppressgctransition-b9a8a774edbd/" aria-label="Open the post: SuppressGCTransition">
      
          SuppressGCTransition
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2023-08-12T00:00:00Z">
        
  
  
  
  
    August 12 2023
  

      </time>
    
    
  </div>

    </div>
    <div class="postShorten-excerpt">
      
        While working on the second edition of the Pro .NET Memory Management book, I did some research on the SuppressGCTransition attribute introduced in .NET 5, and figured it would make a nice complimentary article.
SuppressGCTransition is an attribute you can only apply on a method decorated with the DllImport attribute. It greatly reduces the overhead of the p/invoke, as illustrated with this benchmark:
public class SuppressGcTransitionBenchmark { [Benchmark(Baseline = true)] public int PInvoke() { return Increment(42); [DllImport(&#34;NativeLib.
      
      <p>
        
          <a href="https://minidump.net/suppressgctransition-b9a8a774edbd/" class="postShorten-excerpt_link link" aria-label="Open the post: SuppressGCTransition">Continue reading</a>
        
        
      </p>
    </div>
  </div>
  
    <a href="https://minidump.net/suppressgctransition-b9a8a774edbd/" aria-label="Open the post: SuppressGCTransition">
      <div class="postShorten-thumbnailimg">
        <img alt="" src="https://minidump.net/images/suppressgctransition-b9a8a774edbd-3.webp"/>
      </div>
    </a>
  
</article>

            
              
  
    
  


  

<article class="postShorten postShorten--thumbnailimg-bottom">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="https://minidump.net/reading-net-performance-counters-without-the-perfcounter-api-aca5eab08874/" aria-label="Open the post: Reading .NET performance counters without the PerfCounter API">
      
          Reading .NET performance counters without the PerfCounter API
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2023-02-12T00:00:00Z">
        
  
  
  
  
    February 12 2023
  

      </time>
    
    
  </div>

    </div>
    <div class="postShorten-excerpt">
      
        Note: The code was originally written as part of my job at Datadog and published on the dd-trace-dotnet repository under Apache 2.0 license.
The excerpts of code in this article are therefore licensed under the same terms. Before using them, quoting them, or redistributing them, make sure to check the terms of the license and the notice.
The Datadog .NET tracer has a feature named &ldquo;runtime metrics&rdquo;. It collects technical metrics about the way your application behaves and publishes them to a dedicated dashboard, that you can use to diagnose your performance issues:
      
      <p>
        
          <a href="https://minidump.net/reading-net-performance-counters-without-the-perfcounter-api-aca5eab08874/" class="postShorten-excerpt_link link" aria-label="Open the post: Reading .NET performance counters without the PerfCounter API">Continue reading</a>
        
        
      </p>
    </div>
  </div>
  
    <a href="https://minidump.net/reading-net-performance-counters-without-the-perfcounter-api-aca5eab08874/" aria-label="Open the post: Reading .NET performance counters without the PerfCounter API">
      <div class="postShorten-thumbnailimg">
        <img alt="" src="https://minidump.net/images/reading-net-performance-counters-without-the-perfcounter-api-aca5eab08874-1.webp"/>
      </div>
    </a>
  
</article>

            
              
  
    
  


  

<article class="postShorten postShorten--thumbnailimg-bottom">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="https://minidump.net/showing-unresolved-functions-in-perfview-ab6cd899cb94/" aria-label="Open the post: Showing unresolved functions in PerfView">
      
          Showing unresolved functions in PerfView
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2021-06-02T00:00:00Z">
        
  
  
  
  
    June 02 2021
  

      </time>
    
    
  </div>

    </div>
    <div class="postShorten-excerpt">
      
        One thing that has bothered me quite a bit with PerfView is how it groups all unresolved frames under the same &ldquo;?!?&rdquo; name. I understand that it&rsquo;s a way to reduce noise, but when trying to reduce the CPU usage of an application it can be unsettling.
Take the following example:
Here, &ldquo;?!?&rdquo; is presented as top offender, accounting for more than 7% of the total CPU usage. But I&rsquo;m missing critical information to know whether I should consider it as a bottleneck or not.
      
      <p>
        
          <a href="https://minidump.net/showing-unresolved-functions-in-perfview-ab6cd899cb94/" class="postShorten-excerpt_link link" aria-label="Open the post: Showing unresolved functions in PerfView">Continue reading</a>
        
        
      </p>
    </div>
  </div>
  
    <a href="https://minidump.net/showing-unresolved-functions-in-perfview-ab6cd899cb94/" aria-label="Open the post: Showing unresolved functions in PerfView">
      <div class="postShorten-thumbnailimg">
        <img alt="" src="https://minidump.net/images/showing-unresolved-functions-in-perfview-ab6cd899cb94-1.webp"/>
      </div>
    </a>
  
</article>

            
              
  
    
      
        
      
    
  


  

<article class="postShorten postShorten--thumbnailimg-bottom">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="https://minidump.net/performance-best-practices-in-c-b85a47bdd93a/" aria-label="Open the post: Performance best practices in C#">
      
          Performance best practices in C#
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2020-05-12T00:00:00Z">
        
  
  
  
  
    May 12 2020
  

      </time>
    
    
  </div>

    </div>
    <div class="postShorten-excerpt">
      
        As I recently had to compile a list of best practices in C# for Criteo, I figured it would be nice to share it publicly. The goal of this article is to provide a non-exhaustive list of code patterns to avoid, either because they&rsquo;re risky or because they perform poorly. The list may seem a bit random because it&rsquo;s out of context, but all the items have been spotted in our code at some point and have caused production issues.
      
      <p>
        
          <a href="https://minidump.net/performance-best-practices-in-c-b85a47bdd93a/" class="postShorten-excerpt_link link" aria-label="Open the post: Performance best practices in C#">Continue reading</a>
        
        
      </p>
    </div>
  </div>
  
</article>

            
              
  
    
  


  

<article class="postShorten postShorten--thumbnailimg-bottom">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="https://minidump.net/net-threadpool-starvation-and-how-queuing-makes-it-worse-512c8d570527/" aria-label="Open the post: .NET ThreadPool starvation, and how queuing makes it worse">
      
          .NET ThreadPool starvation, and how queuing makes it worse
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2020-04-27T00:00:00Z">
        
  
  
  
  
    April 27 2020
  

      </time>
    
    
  </div>

    </div>
    <div class="postShorten-excerpt">
      
        There has been plenty of talk about ThreadPool starvation in .NET:
https://blogs.msdn.microsoft.com/vancem/2018/10/16/diagnosing-net-core-threadpool-starvation-with-perfview-why-my-service-is-not-saturating-all-cores-or-seems-to-stall/
https://blogs.msdn.microsoft.com/vsoservice/?p=17665
Or even on the Criteo&rsquo;s blog: http://labs.criteo.com/2018/09/monitor-finalizers-contention-and-threads-in-your-application/
What is it about? This is one of the numerous ways asynchronous code can break if you wait synchronously on a task.
To illustrate that, consider a web server that would execute this code:
/// ProcessRequest is called for every new request public void ProcessRequest() { DoSomethingAsync().Wait(); } You start an asynchronous operation (DoSomethingAsync) then block the current thread.
      
      <p>
        
          <a href="https://minidump.net/net-threadpool-starvation-and-how-queuing-makes-it-worse-512c8d570527/" class="postShorten-excerpt_link link" aria-label="Open the post: .NET ThreadPool starvation, and how queuing makes it worse">Continue reading</a>
        
        
      </p>
    </div>
  </div>
  
    <a href="https://minidump.net/net-threadpool-starvation-and-how-queuing-makes-it-worse-512c8d570527/" aria-label="Open the post: .NET ThreadPool starvation, and how queuing makes it worse">
      <div class="postShorten-thumbnailimg">
        <img alt="" src="https://minidump.net/images/net-threadpool-starvation-and-how-queuing-makes-it-worse-512c8d570527-1.webp"/>
      </div>
    </a>
  
</article>

            
              
  
    
      
        
      
    
  


  

<article class="postShorten postShorten--thumbnailimg-bottom">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="https://minidump.net/optimizing-the-windbg-dml-parser-9f64419f9/" aria-label="Open the post: Optimizing the WinDbg DML parser">
      
          Optimizing the WinDbg DML parser
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2019-01-03T00:00:00Z">
        
  
  
  
  
    January 03 2019
  

      </time>
    
    
  </div>

    </div>
    <div class="postShorten-excerpt">
      
        One of my pet project is writing a custom command window for WinDbg. When testing that custom command window with big outputs, I quickly noticed that the performance was unacceptable: the first few lines would be displayed smoothly, then the application would become slower and slower until almost freezing. I therefore decided to optimize my implementation: tweaking the rendering code, batching updates, … But no matter what I did, the performance was still bad.
      
      <p>
        
          <a href="https://minidump.net/optimizing-the-windbg-dml-parser-9f64419f9/" class="postShorten-excerpt_link link" aria-label="Open the post: Optimizing the WinDbg DML parser">Continue reading</a>
        
        
      </p>
    </div>
  </div>
  
</article>

            
            

          </section>
        
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2023 Kevin Gosse. All Rights Reserved
  </span>
</footer>

      </div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-times"></i>
    </div>
    
      <img id="about-card-picture" src="https://minidump.net/images/profile.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Kevin Gosse</h4>
    
      <div id="about-card-bio">Kevin Gosse has been using Microsoft .NET technologies for more than 15 years, across client, server, and mobile applications. Passionate about debugging. He is Microsoft MVP and is currently employed at Datadog, where he works on the performance of the .NET APM.</div>
    
    
    
  </div>
</div>

    

    
  
    
      <div id="cover" style="background-image:url('https://minidump.net/images/code.png');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js" integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://minidump.net/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js"></script>



<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>




    
  </body>
</html>

